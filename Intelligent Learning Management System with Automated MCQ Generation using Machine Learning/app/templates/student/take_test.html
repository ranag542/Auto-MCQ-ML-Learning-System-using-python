{% extends 'base.html' %}

{% block title %}Take Test{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header bg-info text-white">
        <h3>{{ test.title }}</h3>
        <p class="mb-0">{{ test.description }}</p>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% for question in questions %}
            <div class="mb-4 p-3 border rounded">
                <h5>Question {{ forloop.counter }}</h5>
                <p>{{ question.question_text }}</p>
                
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" 
                           id="q{{ question.id }}_1" value="A" required>
                    <label class="form-check-label" for="q{{ question.id }}_1">
                        A) {{ question.option_a }}
                    </label>
                </div>
                
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" 
                           id="q{{ question.id }}_2" value="B">
                    <label class="form-check-label" for="q{{ question.id }}_2">
                        B) {{ question.option_b }}
                    </label>
                </div>
                
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" 
                           id="q{{ question.id }}_3" value="C">
                    <label class="form-check-label" for="q{{ question.id }}_3">
                        C) {{ question.option_c }}
                    </label>
                </div>
                
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="question_{{ question.id }}" 
                           id="q{{ question.id }}_4" value="D">
                    <label class="form-check-label" for="q{{ question.id }}_4">
                        D) {{ question.option_d }}
                    </label>
                </div>
            </div>
            {% endfor %}
            
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success btn-lg">Submit Test</button>
            </div>
        </form>
    </div>
    <div class="card-footer text-muted">
        Time remaining: <span id="timer">30:00</span>
    </div>
</div>

<script>
    // Timer functionality
    let timeLeft = {{ test.time_limit }} * 60;
    const timer = document.getElementById('timer');
    
    function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        let seconds = timeLeft % 60;
        seconds = seconds < 10 ? '0' + seconds : seconds;
        timer.innerHTML = `${minutes}:${seconds}`;
        
        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert('Time is up! Submitting your test...');
            document.forms[0].submit();
        }
        timeLeft--;
    }
    
    const timerInterval = setInterval(updateTimer, 1000);
</script>
{% endblock %}